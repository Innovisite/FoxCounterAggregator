<md-card>
    <md-toolbar>
      <div class="md-toolbar-tools" md-colors="{'background-color': 'primary-100'}">

        <md-select ng-model="indicatorSelected" ng-change="update()" ng-model-options="{trackBy: '$value.id'}">
          <i class="fa fa-line-chart box-title"></i>
          <md-option ng-value="indicator" ng-repeat="indicator in kpi.indicators">{{indicator.name || indicator.id}}</md-option>
        </md-select>

        <md-select ng-model="sitesSelected[0]" ng-change="update()" ng-model-options="{trackBy: '$value.id'}">
          <md-option ng-value="option" ng-disabled="(sitesSelected[1] && option.id == sitesSelected[1].id)" ng-repeat="option in params.sites">
            {{option.name}}
          </md-option>
        </md-select>

        <span ng-show="showsitecomparing && params.sites.length > 1"> vs 
            <md-button ng-click="params.sites.length > 1 && toggleSiteComparison(true)" ng-show="sitesSelected[1] === undefined">
              select a site
              </md-button>
        </span>

        <md-select ng-show="sitesSelected[1] !== undefined" ng-model="sitesSelected[1]" ng-model-options="{trackBy: '$value.id'}"
          ng-change="update()">
          <md-option ng-value="option" ng-disabled="option.id == sitesSelected[0].id" ng-repeat="option in params.sites">
            {{option.name}}
          </md-option>
        </md-select>

        <md-button ng-show="sitesSelected[1] !== undefined" class="md-button-icon" ng-click="toggleSiteComparison(false)">
          <i class="fa fa-times-circle"></i>
        </md-button>

        <md-button ng-repeat="range in kpi.options.ranges" ng-model="rangeSelected.id" ng-disabled="!rangesEnabled[range.id]" uib-btn-radio="'{{range.id}}'">{{range.name}}
        </md-button>

      </div>
    </md-toolbar>

  <md-card-content>
    <div class="box-body">
      <div class="row left45">
        <div class="col-md-12">
          <div class="caption caption-date" ng-show="periodComparisonSelected">
            <strong>{{params.period.startDate.format('MMM DD, YYYY')}} - {{params.period.endDate.format('MMM DD,YYYY')}}</strong>
          </div>
          <div ng-repeat="elt in chartLegends">
            <div class="caption">
              <div class="circle" ng-style="{'background': elt.color}"></div>
              <strong>{{elt.label}}</strong> ({{ indicatorSelected.id !== 'occ' ? 'Total' : 'Mean'}} {{elt.total}})
            </div>
          </div>
        </div>
      </div>
      <div class="row left45" ng-show="periodComparisonSelected">
        <div class="col-md-12">
          <div class="caption caption-date">
            <strong>{{params.comparedPeriod.startDate.format('MMM DD, YYYY')}} - {{params.comparedPeriod.endDate.format('MMM DD,YYYY')}}</strong>
          </div>
          <div ng-repeat="elt in chartLegendsCompared">
            <div class="caption">
              <div class="circle" ng-style="{'background': elt.color}"></div>
              <strong>{{elt.label}}</strong> ({{ indicatorSelected.id !== 'occ' ? 'Total' : 'Mean'}} {{elt.total}})
            </div>
          </div>
        </div>
      </div>
      <nvd3 options="countingChartOptions" data="countingChartData"></nvd3>
    </div>
  </md-card-content>
  
</md-card>